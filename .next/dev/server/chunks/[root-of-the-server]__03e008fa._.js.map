{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/abdul/Downloads/PayFlow/app/api/verify/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\r\nimport { NextRequest } from \"next/server\";\r\n\r\nconst PAYSTACK_SECRET_KEY = process.env.PAYSTACK_SECRET_KEY;\r\n\r\n/**\r\n * Handles Paystack verification logic\r\n */\r\nasync function verifyTransaction(reference: string) {\r\n    const paystackResponse = await fetch(`https://api.paystack.co/transaction/verify/${reference}`, {\r\n        method: \"GET\",\r\n        headers: {\r\n            Authorization: `Bearer ${PAYSTACK_SECRET_KEY}`,\r\n        },\r\n        cache: 'no-store', // Always re-verify\r\n    });\r\n\r\n    const data = await paystackResponse.json();\r\n\r\n    if (!paystackResponse.ok) {\r\n        console.error(\"Paystack verification error:\", data);\r\n        throw new Error(data.message || \"Failed to verify transaction.\");\r\n    }\r\n\r\n    return data;\r\n}\r\n\r\n\r\nexport async function GET(req: NextRequest) {\r\n    try {\r\n        const { searchParams } = new URL(req.url);\r\n        // This is for the redirect from Paystack which uses query params\r\n        const reference = searchParams.get('reference') || searchParams.get('trxref');\r\n\r\n        if (!reference) {\r\n            return NextResponse.json({ error: \"Transaction reference is required.\" }, { status: 400 });\r\n        }\r\n\r\n        const data = await verifyTransaction(reference);\r\n        return NextResponse.json({ data: data.data });\r\n\r\n    } catch (error) {\r\n        console.error(\"Server error during Paystack verification (GET):\", error);\r\n        return NextResponse.json({ error: error instanceof Error ? error.message : \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}\r\n\r\n\r\nexport async function POST(req: NextRequest) {\r\n    try {\r\n        // This is for your manual 'TransactionVerifier' component\r\n        const { reference } = await req.json();\r\n\r\n        if (!reference) {\r\n            return NextResponse.json({ error: \"Transaction reference is required.\" }, { status: 400 });\r\n        }\r\n\r\n        const data = await verifyTransaction(reference);\r\n        return NextResponse.json({ data: data.data });\r\n\r\n    } catch (error) {\r\n        console.error(\"Server error during Paystack verification (POST):\", error);\r\n        // Handle JSON parse error specifically\r\n        if (error instanceof SyntaxError && error.message.includes(\"JSON\")) {\r\n            return NextResponse.json({ error: \"Invalid request body. Expected { \\\"reference\\\": \\\"...\\\" }\" }, { status: 400 });\r\n        }\r\n        return NextResponse.json({ error: error instanceof Error ? error.message : \"Internal Server Error\" }, { status: 500 });\r\n    }\r\n}"],"names":[],"mappings":";;;;;;AAAA;;AAGA,MAAM,sBAAsB,QAAQ,GAAG,CAAC,mBAAmB;AAE3D;;CAEC,GACD,eAAe,kBAAkB,SAAiB;IAC9C,MAAM,mBAAmB,MAAM,MAAM,CAAC,2CAA2C,EAAE,WAAW,EAAE;QAC5F,QAAQ;QACR,SAAS;YACL,eAAe,CAAC,OAAO,EAAE,qBAAqB;QAClD;QACA,OAAO;IACX;IAEA,MAAM,OAAO,MAAM,iBAAiB,IAAI;IAExC,IAAI,CAAC,iBAAiB,EAAE,EAAE;QACtB,QAAQ,KAAK,CAAC,gCAAgC;QAC9C,MAAM,IAAI,MAAM,KAAK,OAAO,IAAI;IACpC;IAEA,OAAO;AACX;AAGO,eAAe,IAAI,GAAgB;IACtC,IAAI;QACA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,IAAI,GAAG;QACxC,iEAAiE;QACjE,MAAM,YAAY,aAAa,GAAG,CAAC,gBAAgB,aAAa,GAAG,CAAC;QAEpE,IAAI,CAAC,WAAW;YACZ,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqC,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,MAAM,OAAO,MAAM,kBAAkB;QACrC,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,MAAM,KAAK,IAAI;QAAC;IAE/C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,oDAAoD;QAClE,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAwB,GAAG;YAAE,QAAQ;QAAI;IACxH;AACJ;AAGO,eAAe,KAAK,GAAgB;IACvC,IAAI;QACA,0DAA0D;QAC1D,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM,IAAI,IAAI;QAEpC,IAAI,CAAC,WAAW;YACZ,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAqC,GAAG;gBAAE,QAAQ;YAAI;QAC5F;QAEA,MAAM,OAAO,MAAM,kBAAkB;QACrC,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,MAAM,KAAK,IAAI;QAAC;IAE/C,EAAE,OAAO,OAAO;QACZ,QAAQ,KAAK,CAAC,qDAAqD;QACnE,uCAAuC;QACvC,IAAI,iBAAiB,eAAe,MAAM,OAAO,CAAC,QAAQ,CAAC,SAAS;YAChE,OAAO,+QAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAA4D,GAAG;gBAAE,QAAQ;YAAI;QACnH;QACA,OAAO,+QAAY,CAAC,IAAI,CAAC;YAAE,OAAO,iBAAiB,QAAQ,MAAM,OAAO,GAAG;QAAwB,GAAG;YAAE,QAAQ;QAAI;IACxH;AACJ"}}]
}